<div class="mb-6">
  <h2 class="font-semibold text-blue-700 mb-3">Twoje skrzynki</h2>
  <div class="flex flex-wrap gap-2 mb-4" id="inboxes-column">
    <!-- Opcja "Wszystkie skrzynki" -->
    <button 
        data-inbox-id="null"
        class="inbox-btn bg-blue-100 border border-blue-300 rounded-lg px-4 py-2 transition-all duration-200 shadow-sm hover:shadow-md"
        hx-get="/emails?mode=html"
        hx-target="#emails-column"
        hx-swap="innerHTML"
        onclick="setCurrentInbox(null)">
        <div class="font-semibold text-blue-900 whitespace-nowrap">Wszystkie skrzynki</div>
    </button>

    {% for inbox in inboxes %}
    <div class="relative group">
      <button 
          data-inbox-id="{{ inbox.inbox_id }}"
          class="inbox-btn bg-blue-100 border border-blue-300 rounded-lg px-4 py-2 transition-all duration-200 shadow-sm hover:shadow-md"
          hx-get="/emails?inbox_id={{ inbox.inbox_id }}&mode=html"
          hx-target="#emails-column"
          hx-swap="innerHTML"
          onclick="setCurrentInbox('{{ inbox.inbox_id }}')">
          <div class="font-medium text-blue-800 whitespace-nowrap">{{ inbox.login }}</div>
      </button>
      <button
          hx-delete="/inboxes/{{ inbox.inbox_id }}/unselect"
          hx-confirm="Na pewno chcesz usunąć skrzynkę '{{ inbox.login }}'?"
          hx-target="closest .group"
          hx-swap="innerHTML"
           class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full text-xs font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center"
          >
          ✖
      </button>
    </div>
    {% endfor %}
  </div>

  <!-- FORMULARZ DODAWANIA SKRZYNEK -->
  <form
    hx-post="/inboxes/select"
    hx-target="#inboxes-column"
    hx-swap="innerHTML"
    hx-on::after-request="if(event.detail.successful) this.reset()"
    class="space-y-2">
    <input
      type="text"
      name="login"
      placeholder="Login (email)"
      required
      class="w-full rounded-lg border border-blue-300 focus:border-blue-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-20"
    />
    <input
      type="password"
      name="password"
      placeholder="Hasło"
      required
      class="w-full rounded-lg border border-blue-300 focus:border-blue-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-20"
    />
    <button
      type="submit"
      class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
      <span class="mr-1">+</span>
      Dodaj skrzynkę
    </button>
  </form>
</div>

<script>
let selectedInbox = null;

function highlightSelected() {
  document.querySelectorAll('.inbox-btn').forEach(btn => {
    btn.classList.remove('bg-blue-300', 'border-blue-500'); 
    btn.classList.add('bg-blue-100', 'border-blue-300');    
  });

  const idToSelect = selectedInbox === null ? 'null' : selectedInbox;

  const btn = document.querySelector(`[data-inbox-id="${idToSelect}"]`);
  if (btn) {
    btn.classList.remove('bg-blue-100', 'border-blue-300');
    btn.classList.add('bg-blue-300', 'border-blue-500');
  }
}

// Kliknięcie przycisku -> zapamiętaj i podświetl
document.addEventListener('click', e => {
  const btn = e.target.closest('.inbox-btn');
  if (btn) {
    selectedInbox = btn.getAttribute('data-inbox-id');
    highlightSelected();
  }
});

// Po podmianie przez HTMX -> odtwórz podświetlenie
document.body.addEventListener('htmx:afterSwap', highlightSelected);

// Domyślnie podświetl "Wszystkie skrzynki" na start
document.addEventListener('DOMContentLoaded', () => {
  selectedInbox = "null";
  highlightSelected();
});
</script>
