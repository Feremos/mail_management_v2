<div id ="inboxes-wrapper" class="mb-6">
  <h2 class="font-semibold text-blue-400 mb-3 text-lg flex items-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
      <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
      <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
    </svg>
    Twoje skrzynki
  </h2>
  
  <div class="flex flex-wrap gap-2 mb-4">
    <!-- Opcja "Wszystkie skrzynki" -->
    <button 
        data-inbox-id="null"
        class="inbox-btn bg-gray-700 border border-gray-600 hover:border-blue-400 rounded-lg px-4 py-2 transition-all duration-200 hover:bg-gray-600"
        hx-get="/emails?mode=html"
        hx-target="#emails-column"
        hx-swap="innerHTML"
        onclick="setCurrentInbox(null)">
        Wszystkie skrzynki
    </button>

   {% for inbox in inboxes %}
  <div class="relative group inline-block">
    <button 
        data-inbox-id="{{ inbox.inbox_id }}"
        class="inbox-btn bg-gray-700 border border-gray-600 hover:border-blue-400 rounded-lg px-4 py-2 transition-all duration-200 hover:bg-gray-600 w-full"
        
        hx-get="/emails?inbox_id={{ inbox.inbox_id }}&mode=html"
        hx-target="#emails-column"
        hx-swap="innerHTML"
        onclick="setCurrentInbox('{{ inbox.inbox_id }}')">
        {{ inbox.login }}
    </button>

    <button
        hx-delete="/inboxes/{{ inbox.inbox_id }}/unselect?mode=html"
        hx-confirm="Na pewno chcesz usunąć skrzynkę '{{ inbox.login }}'?"
        hx-target="#inboxes-wrapper"
        class="absolute top-0 right-0 -mt-2 -mr-2 w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full text-xs font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center"
        type="button"
        onclick="event.stopPropagation()"
        >
        ✖
    </button>
  </div>
  {% endfor %}

  </div>

  <!-- FORMULARZ DODAWANIA SKRZYNEK -->
  <form
    hx-post="/inboxes/select?mode=html"
    hx-target="#inboxes-column"
    hx-swap="innerHTML"
    hx-on::after-request="if(event.detail.successful) this.reset()"
    class="space-y-3">
    <input
      type="text"
      name="login"
      placeholder="Login (email)"
      required
      class="w-full bg-gray-700 text-gray-200 rounded-lg border border-gray-600 focus:border-blue-400 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 placeholder-gray-400"
    />
    <input
      type="password"
      name="password"
      placeholder="Hasło"
      required
      class="w-full bg-gray-700 text-gray-200 rounded-lg border border-gray-600 focus:border-blue-400 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 placeholder-gray-400"
    />
    <button
      type="submit"
      class="w-full bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
      </svg>
      Dodaj skrzynkę
    </button>
  </form>
</div>

<script>
let selectedInbox = null;

function highlightSelected() {
  document.querySelectorAll('.inbox-btn').forEach(btn => {
    btn.classList.remove('bg-blue-500', 'border-blue-400', 'hover:bg-gray-600'); 
    btn.classList.add('bg-gray-700', 'border-gray-600', 'hover:bg-gray-600');    
  });

  const idToSelect = selectedInbox === null ? 'null' : selectedInbox;

  const btn = document.querySelector(`[data-inbox-id="${idToSelect}"]`);
  if (btn) {
    btn.classList.remove('bg-gray-700', 'border-gray-600', 'hover:bg-gray-600');
    btn.classList.add('bg-blue-500', 'border-blue-400');
  }
}

// Kliknięcie przycisku -> zapamiętaj i podświetl
document.addEventListener('click', e => {
  const btn = e.target.closest('.inbox-btn');
  if (btn) {
    selectedInbox = btn.getAttribute('data-inbox-id');
    highlightSelected();
  }
});

// Po podmianie przez HTMX -> odtwórz podświetlenie
document.body.addEventListener('htmx:afterSwap', highlightSelected);

// Domyślnie podświetl "Wszystkie skrzynki" na start
document.addEventListener('DOMContentLoaded', () => {
  selectedInbox = "null";
  highlightSelected();
});
</script>
